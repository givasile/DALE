%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Welcome to Overleaf --- just edit your LaTeX on the left,
% and we'll compile it for you on the right. If you open the
% 'Share' menu, you can invite other users to edit at the same
% time. See www.overleaf.com/learn for more info. Enjoy!
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass{beamer}
\setbeamersize{text margin left=3mm,text margin right=3mm}
\usepackage{tikz}

\usepackage{natbib}
\bibliographystyle{plain}

\usepackage{amsmath, bm, amssymb}
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{hyperref}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    filecolor=magenta,
    urlcolor=cyan,
    }
% \usepackage[backend=biber, citestyle=authoryear, bibstyle=alphabetic]{biblatex}

\usepackage{tikz}
\usetikzlibrary{matrix,positioning,arrows.meta,arrows,fit,backgrounds,decorations.pathreplacing}

\tikzset{ mymat/.style={ matrix of math nodes, text height=2.5ex, text
depth=0.75ex, text width=6.00ex, align=center, column
sep=-\pgflinewidth, nodes={minimum height=5.0ex} }, mymats/.style={
mymat, nodes={draw,fill=#1} }, mymat2/.style={ matrix of math nodes,
text height=1.0ex, text depth=0.0ex, minimum width=5ex, % text
width=7.00ex, align=center, column sep=-\pgflinewidth }, }

\usetikzlibrary{shapes.geometric, arrows, backgrounds, scopes}
\usepackage{pgfplots} \pgfplotsset{width=6.75cm, compat=newest}
\usepackage[utf8]{inputenc} \DeclareUnicodeCharacter{2212}{âˆ’}
\usepgfplotslibrary{groupplots,dateplot}
\usetikzlibrary{patterns,shapes.arrows}



\usepackage{tikzsymbols}
\usetheme{Frankfurt}
\usecolortheme{seahorse}
\newcommand{\thetab}{\boldsymbol{\theta}}
\newcommand{\xb}{\boldsymbol{x}}
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator*{\argmax}{arg\,max}

\title[DALE]{Paper presentation at ACML 2022}
\subtitle{DALE: Differential Accumulated Local Effects for efficient and accurate global explanations}
\author[Gkolemis, Vasilis] % (optional)
{Vasilis Gkolemis\inst{1,2} \and Theodore Dalamagas\inst{1} \and Christos Diou\inst{2}}

\institute[ATHENA]{\inst{1}}
\institute[HUA]{\inst{2}Harokopio University of Athens}

\institute[ATH-HUA]{
  \inst{1} ATHENA Research and Innovation Center
  \and %
  \inst{2} Harokopio University of Athens
}

\date{December 2022}


% Use a simple TikZ graphic to show where the logo is positioned
% \logo{\begin{tikzpicture}
% \filldraw[color=red!50, fill=red!25, very thick](0,0) circle (0.5);
% \node[draw,color=white] at (0,0) {LOGO HERE};
% \end{tikzpicture}}

%End of title page configuration block
%------------------------------------------------------------
%The next block of commands puts the table of contents at the
%beginning of each section and highlights the current section:

% \AtBeginSection[]
% {
%   \begin{frame}
%     \frametitle{Program}
%     \tableofcontents[currentsection]
%   \end{frame}
% }

% ------------------------------------------------------------
\begin{document}
\frame{\titlepage}
%---------------------------------------------------------


\section{Feature Effect}
\begin{frame}
  \frametitle{Interpretable ML}
  \begin{itemize}
  \item Black-box model \(f(\cdot): \mathcal{X} \rightarrow \mathcal{Y} \), trained on \(\mathcal{D}\)
    \vspace{3mm}

    \item Reveal interpretable properties:
    \begin{itemize}
    \item[] Which features are important (in general)?
    \item[] Which features have positive impact for a class?

    \end{itemize}

  \vspace{3mm}

    \item Categories:
      \begin{itemize}
        \item[\(\rightarrow\)] Global vs local
        \item[\(\rightarrow\)] Model-agnostic vs Model-specific
        \item[\(\rightarrow\)] Output? number, plot, instance etc.
      \end{itemize}
  \end{itemize}

  \noindent\makebox[\linewidth]{\rule{\paperwidth}{0.4pt}}
  Feature Effect: Global, Model-agnostic, outputs plot
\end{frame}

\begin{frame}
  \frametitle{Feature Effect}
  \(y = f(x_s) \rightarrow\) Effect of a single feature \(x_s\) on the output \(y\)
  \vspace{2mm}
  \begin{figure}[ht]
    \centering
    \includegraphics[width=0.7\textwidth]{./figures/pdp-cervical-1.jpeg}
    \caption{Image taken from Interpretable ML book~\citep{molnar2022}}
  \end{figure}

  \noindent\makebox[\linewidth]{\rule{\paperwidth}{0.4pt}}
  Feature Effect is simple and intuitive.
\end{frame}


\begin{frame}
  \frametitle{Feature Effect Methods}
  \begin{itemize}
  \item<1-> PDP
    \begin{itemize}
    \item Expected outcome over \(x_c\): \(f(x_s) = \mathbb{E}_{\mathbf{x_c}}[f(x_s, \mathbf{x_c})]\)
    \item \textbf{Unrealistic instances}
    \end{itemize}

  \item<2-> MPlot
    \begin{itemize}
    \item Expected outcome over \(x_c|x_s\): \(f(x_s) = \mathbb{E}_{\mathbf{x_c}|x_s}[f(x_s, \mathbf{x_c})]\)
    \item \textbf{Aggregated effects}
    \end{itemize}

  \item<3-> ALE
    \begin{itemize}
    \item \(f(x_s) = \int_{x_{min}}^{x_s}\mathbb{E}_{\mathbf{x_c}|x_s=z}[ \frac{\partial f}{\partial x_s}(x_s, \mathbf{x_c})] \partial z\)
    \item \textbf{Resolves both failure modes}
    \end{itemize}

  \end{itemize}
  \noindent\makebox[\linewidth]{\rule{\paperwidth}{0.4pt}}
  PDP vs MPlot vs \alert{ALE}
\end{frame}


\begin{frame}
  \frametitle{ALE approximation}
  ALE definition: \( f(x_s) = \int_{x_{min}}^{x_s}\mathbb{E}_{\mathbf{x_c}|x_s=z}[ \frac{\partial f}{\partial x_s}(x_s, \mathbf{x_c})] \partial z \)
  \noindent\makebox[\linewidth]{\rule{\paperwidth}{0.4pt}}
  ALE approximation from \(\mathcal{D} = { \{\mathbf{x}^i, y^i}\}_{i=1}^N\)

    \[f(x_s) = \sum_k^{k_x} \underbrace{\frac{1}{|\mathcal{S}_k|} \sum_{i:\xb^i \in \mathcal{S}_k} \underbrace{[f(z_k, \mathbf{x^i_c}) - f(z_{k-1}, \mathbf{x^i_c})]}_{\text{point effect}}}_{\text{bin effect}} \]

    \begin{itemize}
    \item Slow \( \rightarrow \) 2 evaluations of \(f\) per point
    \item Restrictive \( \rightarrow\) change bin limits, pay again \(2*N\) evaluations of \(f\)
    \item Insecure \( \rightarrow\) broad bins may create out of distribution samples instances
    \end{itemize}

  \noindent\makebox[\linewidth]{\rule{\paperwidth}{0.4pt}}
  ALE approximation has some disadvantages
\end{frame}




\begin{frame}
  \frametitle{DALE - Differential ALE}
  ALE definition:\(f(x_s) = \Delta x \int_{x_{min}}^{x_s}\mathbb{E}_{\mathbf{x_c}|x_s=z}[ \frac{\partial f}{\partial x_s}(x_s, \mathbf{x_c})] \partial z\)
  \noindent\makebox[\linewidth]{\rule{\paperwidth}{0.4pt}}
  DALE, from the dataset \(\mathcal{D} = { \{\mathbf{x}^i, y^i}\}_{i=1}^N\)

    \[f(x_s) = \sum_k^{k_x} \underbrace{\frac{1}{|\mathcal{S}_k|} \sum_{i:\xb^i \in \mathcal{S}_k} \underbrace{[\frac{\partial f}{\partial x_s}(x_s^i, \mathbf{x^i_c})]}_{\text{point effect}}}_{\text{bin effect}} \]

    \begin{itemize}
    \item Fast \( \rightarrow \) use of auto-differentiation, all derivatives in a single pass
    \item Versatile \( \rightarrow\) point effects computed once, change bins without cost
    \item Secure \( \rightarrow\) does not create artificial instances
    \end{itemize}

  \noindent\makebox[\linewidth]{\rule{\paperwidth}{0.4pt}}
  DALE is a better approximation of ALE, for \alert{differentiable} models
\end{frame}



% chapter 1
\section{DALE vs ALE}

\subsection{Dale is faster and versatile}

\begin{frame}
  \frametitle{DALE is faster and versatile - Theory}
    \[f(x_s) = \sum_k^{k_x} \underbrace{\frac{1}{|\mathcal{S}_k|} \sum_{i:\xb^i \in \mathcal{S}_k} \underbrace{[\frac{\partial f}{\partial x_s}(x_s^i, \mathbf{x^i_c})]}_{\text{point effect}}}_{\text{bin effect}} \]

  \begin{itemize}
  \item Faster
    \begin{itemize}
      \item gradients wrt all features \(\nabla_{\mathbf{x}} f(\mathbf{x^i})\) in a single pass
      \item auto-differentiation must be available (deep learning)
    \end{itemize}
  \item Versatile
    \begin{itemize}
    \item Change bin limits, with near zero computational cost
    \end{itemize}

  \end{itemize}
  \noindent\makebox[\linewidth]{\rule{\paperwidth}{0.4pt}}
  DALE is faster and allows redefining bin-limits
\end{frame}

\begin{frame}
  \frametitle{DALE is faster and versatile - Experiments}
  \begin{figure}[h]
  \centering
  \resizebox{.4\columnwidth}{!}{\input{./../ACML-paper/images/case-1-plot-1.tex}}
  \resizebox{.43\columnwidth}{!}{\input{./../ACML-paper/images/case-1-plot-2.tex}}
  \caption[Case-1-fig-1]{Light setup; small dataset, light \(f\). Heavy setup; big dataset (\(N=10^5\)), heavy \(f\)}
  \label{fig:case-1-plots-1}
\end{figure}

  \noindent\makebox[\linewidth]{\rule{\paperwidth}{0.4pt}}
  DALE considerably accelerates the estimation
\end{frame}


\subsection{DALE is more Accurate}

\begin{frame}
  \frametitle{DALE uses only on-distribution samples}
    \[f(x_s) = \sum_k^{k_x} \underbrace{\frac{1}{|\mathcal{S}_k|} \sum_{i:\xb^i \in \mathcal{S}_k} \underbrace{[\frac{\partial f}{\partial x_s}(x_s^i, \mathbf{x^i_c})]}_{\text{point effect}}}_{\text{bin effect}} \]

  \begin{itemize}
  \item Faster
    \begin{itemize}
      \item gradients wrt all features \(\nabla_{\mathbf{x}} f(\mathbf{x^i})\) in a single pass
      \item auto-differentiation must be available (deep learning)
    \end{itemize}
  \item Versatile
    \begin{itemize}
    \item Change bin limits, with near zero computational cost
    \end{itemize}

  \end{itemize}
  \noindent\makebox[\linewidth]{\rule{\paperwidth}{0.4pt}}
  DALE is faster and allows redefining bin-limits
\end{frame}

\begin{frame}
  \frametitle{DALE vs ALE - 3 Bins}
  \begin{figure}[ht]
    \centering
    \includegraphics[width=0.4\textwidth]{./figures/bin_splitting_3_bins.png}\\
    \includegraphics[width=0.4\textwidth]{./figures/dale_3_bins.png}
    \includegraphics[width=0.4\textwidth]{./figures/ale_3_bins.png}
    \label{}
  \end{figure}
  \noindent\makebox[\linewidth]{\rule{\paperwidth}{0.4pt}}
  We search for a \alert{single configuration (point-estimate) \( \hat{\thetab}\) }
\end{frame}



\begin{frame}
  \frametitle{DALE vs ALE - 5 Bins}
  \begin{figure}[ht]
    \centering
    \includegraphics[width=0.4\textwidth]{./figures/bin_splitting_5_bins.png}\\
    \includegraphics[width=0.4\textwidth]{./figures/dale_5_bins.png}
    \includegraphics[width=0.4\textwidth]{./figures/ale_5_bins.png}
    \label{}
  \end{figure}
  \noindent\makebox[\linewidth]{\rule{\paperwidth}{0.4pt}}
  We search for a \alert{single configuration (point-estimate) \( \hat{\thetab}\) }
\end{frame}


\begin{frame}
  \frametitle{DALE vs ALE - 10 Bins}
  \begin{figure}[ht]
    \centering
    \includegraphics[width=0.4\textwidth]{./figures/bin_splitting_10_bins.png}\\
    \includegraphics[width=0.4\textwidth]{./figures/dale_10_bins.png}
    \includegraphics[width=0.4\textwidth]{./figures/ale_10_bins.png}
    \label{}
  \end{figure}
  \noindent\makebox[\linewidth]{\rule{\paperwidth}{0.4pt}}
  We search for a \alert{single configuration (point-estimate) \( \hat{\thetab}\) }
\end{frame}


\begin{frame}
  \frametitle{DALE vs ALE - 20 Bins}
  \begin{figure}[ht]
    \centering
    \includegraphics[width=0.4\textwidth]{./figures/bin_splitting_20_bins.png}\\
    \includegraphics[width=0.4\textwidth]{./figures/dale_20_bins.png}
    \includegraphics[width=0.4\textwidth]{./figures/ale_20_bins.png}
    \label{}
  \end{figure}
  \noindent\makebox[\linewidth]{\rule{\paperwidth}{0.4pt}}
  We search for a \alert{single configuration (point-estimate) \( \hat{\thetab}\) }
\end{frame}


\begin{frame}
  \frametitle{DALE vs ALE - 40 Bins}
  \begin{figure}[ht]
    \centering
    \includegraphics[width=0.4\textwidth]{./figures/bin_splitting_40_bins.png}\\
    \includegraphics[width=0.4\textwidth]{./figures/dale_40_bins.png}
    \includegraphics[width=0.4\textwidth]{./figures/ale_40_bins.png}
    \label{}
  \end{figure}
  \noindent\makebox[\linewidth]{\rule{\paperwidth}{0.4pt}}
  We search for a \alert{single configuration (point-estimate) \( \hat{\thetab}\) }
\end{frame}

\section{Future Work}

\begin{frame}
  \frametitle{What next?}
  \begin{figure}[ht]
    \centering
    \includegraphics[width=0.4\textwidth]{./figures/bin_splitting_40_bins.png}\\
    \includegraphics[width=0.4\textwidth]{./figures/dale_40_bins.png}
    \includegraphics[width=0.4\textwidth]{./figures/ale_40_bins.png}
    \label{}
  \end{figure}
  \noindent\makebox[\linewidth]{\rule{\paperwidth}{0.4pt}}
  DALE advantages can be a driver for future work
\end{frame}





\begin{frame}[allowframebreaks]
  \frametitle{References}
  \bibliography{bibliography.bib}
\end{frame}


\end{document}